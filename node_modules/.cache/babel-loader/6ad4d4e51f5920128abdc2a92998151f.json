{"ast":null,"code":"// Cullen, Riley\n// AInfographic.js\n// October 26, 2020 \nimport Konva from 'konva';\nimport html2canvas from 'html2canvas';\nimport { ChartHandler, GraphicsHandler, TextHandler } from '../Handlers/index';\n\nclass AInfographic {\n  /**\n   * @summary     An abstract class the provide structure and common functionality\n   *              to the Infographic type.\n   * @description See summary.\n   * \n   * @requires D3.js\n   * @requires Konva.js\n   * \n   * @source _AddTextSelection() uses code from https://konvajs.org/docs/sandbox/Editable_Text.html\n   * @source Selecting mutliple elements demo uses code from https://konvajs.org/docs/select_and_transform/Basic_demo.html#page-title\n   * @source _DrawSVG code taken from https://konvajs.org/docs/sandbox/SVG_On_Canvas.html\n   * @source Download code taken from https://konvajs.org/docs/data_and_serialization/High-Quality-Export.html\n   * \n   * @param {double} height The height of the canvas element\n   * @param {double} width  The width of the canvas element\n   */\n  constructor(height, width, editorHandler, textCallback, chartCallback, graphicCallback) {\n    if (AInfographic === this.constructor) {\n      throw new TypeError('Abstract class \"AInfographic\" cannot be instantiated');\n    }\n\n    if (this.CreateInfographic === undefined) {\n      throw new TypeError('Types extending \"AInfographic\" must implement CreateInfographic()');\n    }\n\n    if (this.Draw === undefined) {\n      throw new TypeError('Types extending \"AInfographic\" must implement Draw()');\n    }\n\n    this._chartHandler = new ChartHandler();\n    this._textHandler = new TextHandler();\n    this._graphicsHandler = new GraphicsHandler();\n    this._tr = new Konva.Transformer({\n      nodes: [],\n      resizeEnabled: false,\n      rotateEnabled: false\n    });\n    this._chartHeight = height;\n    this._chartWidth = width;\n    this._stage = new Konva.Stage({\n      container: 'canvas-container',\n      width: this._chartWidth,\n      height: this._chartHeight\n    });\n    /*this._selectionRectangle = new Konva.Rect({\n        fill: 'rgba(0, 0, 255, 0.5)',\n        visible: false,\n    });\n    this._hasSelected = false;\n    this._isSelecting = false;\n    this._oldNodes = [];\n    this._mouseX1 = 0, this._mouseX2 = 0, this._mouseY1 = 0, this._mouseY2 = 0;*/\n\n    this._main = new Konva.Layer(); // this._UIAdder = new UIAdder(this._chartWidth, this._chartHeight);\n\n    this._editorHandler = editorHandler;\n    this._textCallback = textCallback;\n    this._chartCallback = chartCallback;\n    this._graphicCallback = graphicCallback;\n    this._selectedTextIndex = -1;\n    this._selectedTextHelper = -1;\n    this._selectedChartIndex = -1;\n    this._selectedGraphicIndex = -1;\n\n    this._stage.add(this._main);\n\n    this._main.add(this._tr);\n\n    this._AddStageBorder();\n  }\n  /**\n   * @summary     Returns chart's dimensions to caller.\n   * @description Returns the chart's width and height in the form of a JSON\n   *              object to the caller.\n   * @returns A JSON object containing the chart's width and height.\n   */\n\n\n  GetDimensions() {\n    return {\n      width: this._chartWidth,\n      height: this._chartHeight\n    };\n  }\n  /**\n   * @summary     Manages memory for infographic type.\n   * @description A function that is responsible for freeing memory that would \n   *              otherwise cause memory leaks. \n   */\n\n\n  Clean() {\n    // Remove chart/text listeners\n    this._RemoveTextListeners();\n\n    this._RemoveChartListeners();\n\n    this._RemoveGraphicListeners(); // Remove all the elements from this._stage\n\n\n    this._stage.destroy();\n\n    this._stage = 0;\n  }\n\n  ClearSelection() {\n    this._tr.nodes([]);\n\n    this._selectedChartIndex = -1;\n    this._selectedGraphicIndex = -1;\n    this._selectedTextIndex = this._selectedTextHelper = -1;\n  }\n\n  Download() {\n    // function from https://stackoverflow.com/a/15832662/512042\n    function downloadURI(uri, name) {\n      var link = document.createElement('a');\n      link.download = name;\n      link.href = uri;\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      link.remove();\n    }\n\n    var dataURL = this._stage.toDataURL({\n      pixelRatio: 5\n    });\n\n    downloadURI(dataURL, 'Infographic.png');\n  }\n\n  UpdateLayering(layerAction) {\n    if (this._selectedChartIndex !== -1) {\n      this._chartHandler.UpdateLayering(this._selectedChartIndex, layerAction);\n    } else if (this._selectedGraphicIndex !== -1) {\n      this._graphicsHandler.UpdateLayering(this._selectedGraphicIndex, layerAction);\n    } else if (this._selectedTextIndex !== -1) {\n      this._textHandler.UpdateLayering(this._selectedTextIndex, layerAction);\n    }\n  }\n\n  _CreateSwitchableContainer(attrs = {}, id = '') {\n    attrs.name = 'Switchable Container ' + id;\n    return new Konva.Group(attrs);\n  }\n  /**\n   * @summary Removes the event listeners from each text node.\n   */\n\n\n  _RemoveTextListeners() {\n    var selection = this._stage.find(node => {\n      return node.hasName('Selectable') && node.hasName('EditableText');\n    });\n\n    selection.forEach(textElem => {\n      textElem.off('dblclick');\n    });\n  }\n  /**\n   * @summary Removes the event listeners from each chart node.\n   */\n\n\n  _RemoveChartListeners() {\n    var selection = this._stage.find(node => {\n      return node.hasName('Selectable') && node.hasName('Chart');\n    });\n\n    selection.forEach(chartElem => {\n      chartElem.off('dblclick');\n    });\n  }\n\n  _RemoveGraphicListeners() {\n    var selection = this._stage.find(node => {\n      return node.hasName('Graphic');\n    });\n\n    selection.forEach(group => {\n      group.off('dblclick');\n    });\n  }\n\n  _CreateImage({\n    x,\n    y,\n    width,\n    height,\n    src,\n    group\n  }) {\n    let image = new Image(),\n        imageHelper = new Konva.Image(),\n        imageGroup = new Konva.Group();\n\n    image.onload = () => {\n      imageHelper.setAttrs({\n        x: x,\n        y: y,\n        height: height,\n        width: width,\n        image: image,\n        opacity: 1,\n        stroke: 'black',\n        strokeWidth: 0\n      });\n      imageHelper.cache();\n      imageHelper.filters([Konva.Filters.Contrast, Konva.Filters.Brighten, Konva.Filters.Blur]);\n      imageHelper.brightness(0);\n      imageHelper.blurRadius(0);\n      imageHelper.contrast(0);\n\n      this._main.batchDraw();\n\n      image.onload = null;\n    };\n\n    image.src = src;\n    imageGroup.add(imageHelper);\n    group.add(imageGroup);\n\n    this._graphicsHandler.AddGraphic({\n      type: 'image',\n      graphic: imageHelper,\n      group: imageGroup\n    });\n  }\n  /**\n   * @summary     A function that takes in a font and a font weight and maps it\n   *              to the proper quill code.\n   * \n   * @param {string} font   The font associated with a quill code.\n   * @param {int}    weight The weight associated with a quill code. \n   */\n\n\n  _quillMap(font, weight = 0) {\n    if (font === 'museo' && weight === 900) return '900-museo';else if (font === 'canada-type-gibson') {\n      switch (weight) {\n        case 100:\n          return '100-canada';\n\n        case 200:\n          return '200-canada';\n\n        case 400:\n          return '400-canada';\n\n        case 500:\n          return '500-canada';\n\n        case 600:\n          return '600-canada';\n\n        case 700:\n          return '700-canada';\n\n        case 900:\n          return '900-canada';\n\n        default:\n          return '100-canada';\n      }\n    } else if (font === 'Montserrat') return '200-Montserrat';else if (font === 'Open Sans') return 'Open-Sans';else if (font === 'Roboto') {\n      switch (weight) {\n        case 100:\n          return '100-Roboto';\n\n        case 300:\n          return '300-Roboto';\n\n        case 400:\n          return '400-Roboto';\n\n        case 500:\n          return '500-Roboto';\n\n        case 700:\n          return '700-Roboto';\n\n        case 900:\n          return '900-Roboto';\n\n        default:\n          return '100-Roboto';\n      }\n    }\n  }\n  /**\n   * @summary     Adds a black border around the edges of the canvas element.\n   */\n\n\n  _AddStageBorder() {\n    var bkg = new Konva.Rect({\n      x: 0,\n      y: 0,\n      width: this._stage.width(),\n      height: this._stage.height(),\n      fill: 'white',\n      stroke: 'black'\n    });\n\n    this._main.add(bkg);\n\n    bkg.moveToBottom();\n  }\n  /**\n   * @summary     Returns the width of a text element given the text's font.\n   * @description Using canvas' measureText function, _GetTextWidth returns the\n   *              width in pixels of a given piece of text.\n   * \n   * @param {string} text       The text we want to determine the width of.\n   * @param {double} fontSize   The font size of the text we want to find the width of.\n   * @param {string} fontFamily The font family of the text we want to analyze.\n   */\n\n\n  _GetTextWidth(text, fontSize, fontFamily) {\n    var canvas = document.createElement('canvas');\n    var ctx = canvas.getContext('2d');\n    ctx.font = fontSize + 'px ' + fontFamily;\n    var helper = ctx.measureText(text).width;\n    canvas.remove();\n    return helper;\n  }\n  /**\n   * @param {double} width  The width of the element we are centering.\n   * @param {double} center The x-coordinate we want to center about.\n   */\n\n\n  _CenterXAbout(width, center) {\n    return center - width / 2;\n  }\n  /**\n   * @summary     Calls additional functions to complete the infographic.\n   * @description Renders all of the text elements and adds the capability to \n   *              edit graphs and text elements.\n   */\n\n\n  _FinalizeInfog() {\n    this._RenderText();\n\n    this._AddGraphSelection();\n\n    this._AddTextSelection();\n\n    this._AddGraphicSelection(); // this._AddMultipleElementSelector();\n\n  }\n  /**\n   * @summary     Renders all of the text elements.\n   * @description Iterates through all of the elements in textHandler and converts\n   *              them from DOM elements to Konva.Image elements.\n   */\n\n\n  _RenderText() {\n    var helperElem = document.createElement('div');\n    helperElem.style.position = 'absolute';\n    document.getElementById('renderHelper').appendChild(helperElem);\n\n    for (var i = 0; i < this._textHandler.GetSize(); i++) {\n      helperElem.appendChild(this._textHandler.GetTextElem(i));\n\n      this._HTMLToCanvas('.EditableText', i);\n\n      this._textHandler.GetTextElem(i).remove();\n    }\n\n    helperElem.remove();\n  }\n  /**\n   * @summary     Converts DOM elements on the page to Konva.Image elements\n   * @description Uses the html2canvas module to convert DOM elements located \n   *              within the body into Konva.Image elements.\n   * \n   * @param {int} index The index of the text element we want to convert.\n   */\n\n\n  _HTMLToCanvas(query, index) {\n    var element = document.querySelector(query); // var comp = window.getComputedStyle(element, null);\n\n    html2canvas(element, {\n      logging: false,\n      backgroundColor: null,\n      scrollY: -window.scrollY // width: comp.width.replace('px', ''),\n\n    }).then(image => {\n      // console.log('image width: ' + image.width)\n      this._textHandler.GetImage(index).image(image);\n\n      this._main.batchDraw();\n    }).catch(() => {\n      var helperElem = document.createElement('div');\n      helperElem.style.position = 'absolute';\n      document.getElementById('renderHelper').appendChild(helperElem);\n      helperElem.appendChild(this._textHandler.GetTextElem(index));\n\n      this._HTMLToCanvas('.EditableText', index);\n\n      this._textHandler.GetTextElem(index).remove();\n\n      helperElem.remove();\n    });\n    /*console.log('width: ' + comp.width);\n    console.log('height: ' + comp.height);\n    console.log('x: ' + comp.x);\n    console.log('y: ' + comp.y)*/\n  }\n  /**\n   * @summary     Adds the capability to select and edit text.\n   * @description Iterates through all of the elements in the text handler and\n   *              adds an event listener that triggers when the text element\n   *              is double clicked.\n   */\n\n\n  _AddTextSelection() {\n    var selection = this._stage.find(node => {\n      return node.hasName('Selectable') && node.hasName('EditableText');\n    });\n\n    selection.forEach(textElem => {\n      textElem.on('dblclick', () => {\n        textElem.setAttr('draggable', true);\n\n        this._tr.nodes([textElem]);\n\n        this._tr.moveToTop();\n\n        this._main.batchDraw();\n\n        this._selectedTextIndex = textElem.getAttr('id');\n        this._selectedTextHelper = this._selectedTextIndex;\n\n        this._textCallback(this._textHandler.GetHandlerElem(this._selectedTextIndex));\n\n        this._editorHandler('text-editor');\n\n        setTimeout(() => {\n          this._stage.on('click', HandleOutsideClick);\n        });\n\n        var HandleOutsideClick = e => {\n          if (e.target !== textElem) {\n            this._selectedTextIndex = -1;\n\n            this._editorHandler('none');\n\n            this._tr.nodes([]);\n\n            textElem.setAttr('draggable', false);\n\n            this._main.batchDraw();\n\n            this._stage.off('click', HandleOutsideClick);\n          }\n        };\n      });\n      textElem.on('dragend', () => {\n        this._SwitchContainerOnDrag(textElem);\n      });\n    });\n  }\n  /**\n   * @summary     Updates current handler element.\n   * @description Updates the text handler element located at _selectedTextIndex\n   *              with data from the parameterized textElem variable.\n   * \n   * @param {JSON} textElem A JSON object containing the updated textElem information.\n   */\n\n\n  UpdateTextHandler(textElem) {\n    if (textElem.image === undefined || textElem.textElem === undefined || textElem.group === undefined || textElem.spanCSS === undefined || textElem === 0) {\n      return;\n    }\n\n    this._textHandler.UpdateTextElem({\n      index: this._selectedTextHelper,\n      textElem: textElem.textElem,\n      group: textElem.group,\n      image: textElem.image,\n      spanCSS: textElem.spanCSS\n    });\n\n    this._selectedTextHelper = -1;\n  }\n\n  Remove() {\n    // TODO remove entries from handler\n    if (this._selectedChartIndex !== -1) {\n      this._tr.nodes([]);\n\n      this._main.batchDraw();\n\n      this._chartHandler.RemoveHandlerElem(this._selectedChartIndex);\n\n      this._selectedChartIndex = -1;\n    } else if (this._selectedTextIndex !== -1) {\n      this._tr.nodes([]);\n\n      this._main.batchDraw();\n\n      this._textHandler.RemoveHandlerElem(this._selectedTextIndex);\n\n      this._selectedChartIndex = -1;\n    } else if (this._selectedGraphicIndex !== -1) {\n      this._tr.nodes([]);\n\n      this._main.batchDraw();\n\n      this._graphicsHandler.RemoveHandlerElem(this._selectedGraphicIndex);\n\n      this._selectedGraphicIndex = -1;\n    }\n  }\n\n  UpdateChartDecorators(settings) {\n    if (settings === 0 || this._selectedChartIndex === -1) return;\n\n    this._chartHandler.UpdateChartDecorators(this._selectedChartIndex, settings);\n  }\n  /**\n   * @summary     Updates the selected chart.\n   * @description Updates the chart (and its associated data) at index \n   *              _selectedChartIndex.\n   * @param {misc} chartData The structure of this variable depends on the \n   *                         type of chart we are dealing with.\n   */\n\n\n  UpdateChartData(chartData) {\n    if (chartData === 0 || this._selectedChartIndex === -1) return;\n\n    var elem = this._chartHandler.GetHandlerElem(this._selectedChartIndex),\n        name = elem.group.getAttr('name');\n\n    if (name === 'Selectable Chart Waffle') {\n      // We assume that the data will be formatted as follows\n      // data = {\n      //    numerator: {num}, denominator: {num}\n      // }\n      if (chartData.numerator === 0 || chartData.denominator === 0) return;\n      var numerator = chartData.numerator,\n          denominator = chartData.denominator;\n      elem.chart.UpdateData(parseInt(numerator), parseInt(denominator));\n    } else {\n      // We assume that the data will be formated as follows\n      // data = [\n      //    { category: {string}, value: {float}, color: {string}}, ...   \n      // ]\n      elem.chart.UpdateData(chartData);\n    }\n\n    this._UpdateDecorators(elem);\n  }\n\n  UpdateChartSettings(settings) {\n    if (settings === 0 || this._selectedChartIndex === -1) return;\n\n    let elem = this._chartHandler.GetHandlerElem(this._selectedChartIndex);\n\n    elem.chart.UpdateChartSettings(settings);\n\n    this._UpdateDecorators(elem);\n  }\n\n  UpdateGraphicSettings(settings) {\n    if (settings === 0 || this._selectedGraphicIndex === -1) return;\n\n    this._graphicsHandler.UpdateGraphicSettings({\n      id: this._selectedGraphicIndex,\n      settings: settings\n    });\n\n    this._tr.forceUpdate();\n\n    this._main.batchDraw();\n  }\n  /**\n   * @summary     Updates decorators.\n   * @description Iterates though all the decorators in handlerElem and updates\n   *              them.\n   * \n   * @param {JSON} handlerElem \n   */\n\n\n  _UpdateDecorators(handlerElem) {\n    var prev = handlerElem.chart;\n\n    for (var i = 0; i <= handlerElem.decoratorSize; i++) {\n      handlerElem.decorators[i].UpdateDecorator(prev);\n      prev = handlerElem.decorators[i];\n    }\n\n    prev.CreateChart();\n\n    this._tr.forceUpdate();\n\n    this._main.batchDraw();\n  }\n  /**\n   * @summary     Adds the capability to select and edit graphs.\n   * @description Iterates through all of the elements in the graph handler and\n   *              adds an event listener when they are double clicked on.\n   */\n\n\n  _AddGraphSelection() {\n    var selection = this._stage.find(node => {\n      return node.hasName('Selectable') && node.hasName('Chart');\n    });\n\n    selection.forEach(chart => {\n      /**\n       * Adds ability to select and edit graphs.\n       */\n      chart.on('dblclick', () => {\n        this._selectedChartIndex = parseInt(chart.getAttr('id'));\n\n        this._tr.nodes([chart]);\n\n        this._tr.moveToTop();\n\n        this._main.batchDraw();\n\n        chart.setAttr('draggable', true);\n\n        let selectedChart = this._chartHandler.GetHandlerElem(this._selectedChartIndex).chart,\n            dSettings = this._chartHandler.GetDecoratorSettingsArray(this._selectedChartIndex);\n\n        this._chartCallback(selectedChart.GetData(), selectedChart.GetChartSettings(), dSettings);\n\n        if (chart.getAttr('name') === 'Selectable Chart Waffle') {\n          this._editorHandler('waffle-editor');\n        } else if (chart.getAttr('name') === 'Selectable Chart Pie') {\n          this._editorHandler('pie-editor');\n        } else if (chart.getAttr('name') === 'Selectable Chart Bar') {\n          this._editorHandler('bar-editor');\n        } else if (chart.getAttr('name') === 'Selectable Chart Stacked') {\n          this._editorHandler('stacked-bar-editor');\n        } else if (chart.getAttr('name') === 'Selectable Chart Line') {\n          this._editorHandler('line-editor');\n        } else if (chart.getAttr('name') === 'Selectable Chart Icon') {\n          this._editorHandler('icon-bar-editor');\n        } else if (chart.getAttr('name') === 'Selectable Chart Donut') {\n          this._editorHandler('donut-editor');\n        }\n\n        setTimeout(() => {\n          this._stage.on('click', HandleOutsideClick);\n        });\n\n        var HandleOutsideClick = e => {\n          if (e.target !== chart) {\n            this._selectedChartIndex = -1;\n\n            this._editorHandler('none');\n\n            this._tr.nodes([]);\n\n            chart.setAttr('draggable', false);\n\n            this._main.batchDraw();\n\n            this._stage.off('click', HandleOutsideClick);\n          }\n        };\n      });\n      chart.on('dragend', () => {\n        this._SwitchContainerOnDrag(chart);\n      });\n    });\n  }\n\n  _AddGraphicSelection() {\n    var selection = this._stage.find(node => {\n      return node.hasName('Graphic');\n    });\n\n    selection.forEach(group => {\n      group.on('dblclick', () => {\n        this._selectedGraphicIndex = group.getAttr('id');\n\n        let type = this._graphicsHandler.GetType(this._selectedGraphicIndex);\n\n        this._tr.nodes([group]);\n\n        this._tr.moveToTop();\n\n        this._main.batchDraw();\n\n        group.setAttr('draggable', true);\n\n        this._editorHandler(type + '-editor');\n\n        this._graphicCallback(this._graphicsHandler.GetSettings(this._selectedGraphicIndex));\n\n        setTimeout(() => {\n          this._stage.on('click', HandleOutsideClick);\n        });\n\n        var HandleOutsideClick = e => {\n          if (e.target !== group) {\n            this._selectedGraphicIndex = -1;\n\n            this._tr.nodes([]);\n\n            group.setAttr('draggable', false);\n\n            this._main.batchDraw();\n\n            this._editorHandler('none');\n\n            this._stage.off('click', HandleOutsideClick);\n          }\n        };\n      });\n      group.on('dragend', () => {\n        this._SwitchContainerOnDrag(group);\n      });\n    });\n  }\n\n  _SwitchContainerOnDrag(elem) {\n    let selection = this._stage.find(node => {\n      return node.hasName('Switchable') && node.hasName('Container');\n    }),\n        parent = this._FindTopContainer(elem);\n\n    selection = selection.filter(d => parent !== d);\n    selection.forEach(group => {\n      if (Konva.Util.haveIntersection(group.getClientRect(), elem.getClientRect())) {\n        let absPos = elem.getAbsolutePosition();\n        elem.moveTo(group);\n        elem.absolutePosition({\n          x: absPos.x,\n          y: absPos.y\n        });\n      }\n    });\n  }\n\n  _FindTopContainer(elem) {\n    let parent = elem.getParent();\n\n    while (parent.getDepth > 2 || !parent.hasName('Switchable')) {\n      parent = parent.getParent();\n    }\n\n    return parent;\n  }\n\n  _AddMultipleElementSelector() {\n    this._main.add(this._selectionRectangle);\n\n    this._MultipleSelectorStart();\n\n    this._MultipleSelectorMove();\n\n    this._MultipleSelectorEnd();\n\n    this._MultipleSelectorDeselect();\n  }\n\n  _MultipleSelectorStart() {\n    this._stage.on('mousedown touchstart', e => {\n      //if (e.target !== this._stage) return;\n      this._isSelecting = true;\n      this._mouseX1 = this._stage.getPointerPosition().x;\n      this._mouseX2 = this._mouseX1;\n      this._mouseY1 = this._stage.getPointerPosition().y;\n      this._mouseY2 = this._mouseY1;\n\n      this._selectionRectangle.visible(true);\n\n      this._selectionRectangle.width(0);\n\n      this._selectionRectangle.height(0);\n\n      this._main.batchDraw();\n    });\n  }\n\n  _MultipleSelectorMove() {\n    this._stage.on('mousemove touchmove', () => {\n      if (!this._selectionRectangle.visible()) return;\n      this._mouseX2 = this._stage.getPointerPosition().x;\n      this._mouseY2 = this._stage.getPointerPosition().y;\n\n      this._selectionRectangle.setAttrs({\n        x: Math.min(this._mouseX1, this._mouseX2),\n        y: Math.min(this._mouseY1, this._mouseY2),\n        width: Math.abs(this._mouseX2 - this._mouseX1),\n        height: Math.abs(this._mouseY2 - this._mouseY1)\n      });\n\n      this._main.batchDraw();\n    });\n  }\n\n  _MultipleSelectorEnd() {\n    this._stage.on('mouseup touchend', () => {\n      if (!this._selectionRectangle.visible()) return; // selection code \n\n      var elems = this._stage.find('.Selectable').toArray();\n\n      var box = this._selectionRectangle.getClientRect();\n      /*var selected = elems.filter((element) => {\n          if (Konva.Util.haveIntersection(box, element.getClientRect())) {\n              alert('h')\n              return element;\n          }\n          var x = element.getClientRect().x,\n              y = element.getClientRect().y;\n          if (x >= box.x &&\n              x <= box.x + box.width &&\n              y >= box.y &&\n              y <= box.y + box.height)\n          {\n              element.setAttr('draggable', true);\n              this._oldNodes.push(element);\n              return element;\n          }\n      });*/\n\n\n      var selected = elems.filter(elem => Konva.Util.haveIntersection(box, elem.getClientRect()));\n      console.log(selected);\n\n      this._tr.nodes(selected);\n\n      this._tr.moveToTop();\n\n      this._main.batchDraw();\n\n      setTimeout(() => {\n        this._selectionRectangle.visible(false);\n\n        this._main.batchDraw();\n\n        this._hasSelected = true;\n        this._isSelecting = false;\n      });\n    });\n  }\n\n  _MultipleSelectorDeselect() {\n    this._stage.on('click tap', e => {\n      if (this._selectionRectangle.visible()) return;\n\n      if (this._hasSelected) {\n        this._oldNodes.forEach(node => {\n          node.setAttr('draggable', false);\n        });\n\n        this._tr.nodes([]);\n\n        this._main.batchDraw();\n\n        this._hasSelected = false;\n        return;\n      }\n    });\n  }\n\n}\n\nexport { AInfographic };","map":{"version":3,"sources":["/Users/mialee/Documents/GitHub/ShareNWWebtool/src/js/InfographicTemplates/AInfographic.js"],"names":["Konva","html2canvas","ChartHandler","GraphicsHandler","TextHandler","AInfographic","constructor","height","width","editorHandler","textCallback","chartCallback","graphicCallback","TypeError","CreateInfographic","undefined","Draw","_chartHandler","_textHandler","_graphicsHandler","_tr","Transformer","nodes","resizeEnabled","rotateEnabled","_chartHeight","_chartWidth","_stage","Stage","container","_main","Layer","_editorHandler","_textCallback","_chartCallback","_graphicCallback","_selectedTextIndex","_selectedTextHelper","_selectedChartIndex","_selectedGraphicIndex","add","_AddStageBorder","GetDimensions","Clean","_RemoveTextListeners","_RemoveChartListeners","_RemoveGraphicListeners","destroy","ClearSelection","Download","downloadURI","uri","name","link","document","createElement","download","href","body","appendChild","click","removeChild","remove","dataURL","toDataURL","pixelRatio","UpdateLayering","layerAction","_CreateSwitchableContainer","attrs","id","Group","selection","find","node","hasName","forEach","textElem","off","chartElem","group","_CreateImage","x","y","src","image","Image","imageHelper","imageGroup","onload","setAttrs","opacity","stroke","strokeWidth","cache","filters","Filters","Contrast","Brighten","Blur","brightness","blurRadius","contrast","batchDraw","AddGraphic","type","graphic","_quillMap","font","weight","bkg","Rect","fill","moveToBottom","_GetTextWidth","text","fontSize","fontFamily","canvas","ctx","getContext","helper","measureText","_CenterXAbout","center","_FinalizeInfog","_RenderText","_AddGraphSelection","_AddTextSelection","_AddGraphicSelection","helperElem","style","position","getElementById","i","GetSize","GetTextElem","_HTMLToCanvas","query","index","element","querySelector","logging","backgroundColor","scrollY","window","then","GetImage","catch","on","setAttr","moveToTop","getAttr","GetHandlerElem","setTimeout","HandleOutsideClick","e","target","_SwitchContainerOnDrag","UpdateTextHandler","spanCSS","UpdateTextElem","Remove","RemoveHandlerElem","UpdateChartDecorators","settings","UpdateChartData","chartData","elem","numerator","denominator","chart","UpdateData","parseInt","_UpdateDecorators","UpdateChartSettings","UpdateGraphicSettings","forceUpdate","handlerElem","prev","decoratorSize","decorators","UpdateDecorator","CreateChart","selectedChart","dSettings","GetDecoratorSettingsArray","GetData","GetChartSettings","GetType","GetSettings","parent","_FindTopContainer","filter","d","Util","haveIntersection","getClientRect","absPos","getAbsolutePosition","moveTo","absolutePosition","getParent","getDepth","_AddMultipleElementSelector","_selectionRectangle","_MultipleSelectorStart","_MultipleSelectorMove","_MultipleSelectorEnd","_MultipleSelectorDeselect","_isSelecting","_mouseX1","getPointerPosition","_mouseX2","_mouseY1","_mouseY2","visible","Math","min","abs","elems","toArray","box","selected","console","log","_hasSelected","_oldNodes"],"mappings":"AAAA;AACA;AACA;AAEA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,WAAP,MAAwB,aAAxB;AACA,SAASC,YAAT,EAAuBC,eAAvB,EAAwCC,WAAxC,QAA2D,mBAA3D;;AAEA,MAAMC,YAAN,CACA;AACI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACIC,EAAAA,WAAW,CAACC,MAAD,EAASC,KAAT,EAAgBC,aAAhB,EAA+BC,YAA/B,EAA6CC,aAA7C,EAA4DC,eAA5D,EACX;AACI,QAAIP,YAAY,KAAK,KAAKC,WAA1B,EAAuC;AACnC,YAAM,IAAIO,SAAJ,CAAc,sDAAd,CAAN;AACH;;AAED,QAAI,KAAKC,iBAAL,KAA2BC,SAA/B,EAA0C;AACtC,YAAM,IAAIF,SAAJ,CAAc,mEAAd,CAAN;AACH;;AAED,QAAI,KAAKG,IAAL,KAAcD,SAAlB,EAA6B;AACzB,YAAM,IAAIF,SAAJ,CAAc,sDAAd,CAAN;AACH;;AAED,SAAKI,aAAL,GAAqB,IAAIf,YAAJ,EAArB;AACA,SAAKgB,YAAL,GAAoB,IAAId,WAAJ,EAApB;AACA,SAAKe,gBAAL,GAAwB,IAAIhB,eAAJ,EAAxB;AAEA,SAAKiB,GAAL,GAAW,IAAIpB,KAAK,CAACqB,WAAV,CAAsB;AAC7BC,MAAAA,KAAK,EAAE,EADsB;AAE7BC,MAAAA,aAAa,EAAE,KAFc;AAG7BC,MAAAA,aAAa,EAAE;AAHc,KAAtB,CAAX;AAMA,SAAKC,YAAL,GAAoBlB,MAApB;AACA,SAAKmB,WAAL,GAAmBlB,KAAnB;AACA,SAAKmB,MAAL,GAAc,IAAI3B,KAAK,CAAC4B,KAAV,CAAgB;AAC1BC,MAAAA,SAAS,EAAE,kBADe;AAE1BrB,MAAAA,KAAK,EAAE,KAAKkB,WAFc;AAG1BnB,MAAAA,MAAM,EAAE,KAAKkB;AAHa,KAAhB,CAAd;AAMA;AACR;AACA;AACA;AACA;AACA;AACA;AACA;;AAEQ,SAAKK,KAAL,GAAa,IAAI9B,KAAK,CAAC+B,KAAV,EAAb,CAxCJ,CAyCI;;AAEA,SAAKC,cAAL,GAAsBvB,aAAtB;AACA,SAAKwB,aAAL,GAAqBvB,YAArB;AACA,SAAKwB,cAAL,GAAsBvB,aAAtB;AACA,SAAKwB,gBAAL,GAAwBvB,eAAxB;AAEA,SAAKwB,kBAAL,GAA0B,CAAC,CAA3B;AACA,SAAKC,mBAAL,GAA2B,CAAC,CAA5B;AACA,SAAKC,mBAAL,GAA2B,CAAC,CAA5B;AACA,SAAKC,qBAAL,GAA6B,CAAC,CAA9B;;AAEA,SAAKZ,MAAL,CAAYa,GAAZ,CAAgB,KAAKV,KAArB;;AAEA,SAAKA,KAAL,CAAWU,GAAX,CAAe,KAAKpB,GAApB;;AAEA,SAAKqB,eAAL;AACH;AAED;AACJ;AACA;AACA;AACA;AACA;;;AACIC,EAAAA,aAAa,GACb;AACI,WAAO;AACHlC,MAAAA,KAAK,EAAE,KAAKkB,WADT;AAEHnB,MAAAA,MAAM,EAAE,KAAKkB;AAFV,KAAP;AAIH;AAED;AACJ;AACA;AACA;AACA;;;AACIkB,EAAAA,KAAK,GACL;AACI;AACA,SAAKC,oBAAL;;AACA,SAAKC,qBAAL;;AACA,SAAKC,uBAAL,GAJJ,CAMI;;;AACA,SAAKnB,MAAL,CAAYoB,OAAZ;;AACA,SAAKpB,MAAL,GAAc,CAAd;AACH;;AAEDqB,EAAAA,cAAc,GACd;AACI,SAAK5B,GAAL,CAASE,KAAT,CAAe,EAAf;;AACA,SAAKgB,mBAAL,GAA2B,CAAC,CAA5B;AACA,SAAKC,qBAAL,GAA6B,CAAC,CAA9B;AACA,SAAKH,kBAAL,GAA0B,KAAKC,mBAAL,GAA2B,CAAC,CAAtD;AACH;;AAEDY,EAAAA,QAAQ,GACR;AACI;AACA,aAASC,WAAT,CAAqBC,GAArB,EAA0BC,IAA1B,EAAgC;AAC5B,UAAIC,IAAI,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAX;AACAF,MAAAA,IAAI,CAACG,QAAL,GAAgBJ,IAAhB;AACAC,MAAAA,IAAI,CAACI,IAAL,GAAYN,GAAZ;AACAG,MAAAA,QAAQ,CAACI,IAAT,CAAcC,WAAd,CAA0BN,IAA1B;AACAA,MAAAA,IAAI,CAACO,KAAL;AACAN,MAAAA,QAAQ,CAACI,IAAT,CAAcG,WAAd,CAA0BR,IAA1B;AACAA,MAAAA,IAAI,CAACS,MAAL;AACH;;AACD,QAAIC,OAAO,GAAG,KAAKpC,MAAL,CAAYqC,SAAZ,CAAsB;AAACC,MAAAA,UAAU,EAAE;AAAb,KAAtB,CAAd;;AACAf,IAAAA,WAAW,CAACa,OAAD,EAAU,iBAAV,CAAX;AACH;;AAEDG,EAAAA,cAAc,CAACC,WAAD,EACd;AACI,QAAI,KAAK7B,mBAAL,KAA6B,CAAC,CAAlC,EAAqC;AACjC,WAAKrB,aAAL,CAAmBiD,cAAnB,CAAkC,KAAK5B,mBAAvC,EAA4D6B,WAA5D;AACH,KAFD,MAEO,IAAI,KAAK5B,qBAAL,KAA+B,CAAC,CAApC,EAAuC;AAC1C,WAAKpB,gBAAL,CAAsB+C,cAAtB,CAAqC,KAAK3B,qBAA1C,EAAiE4B,WAAjE;AACH,KAFM,MAEA,IAAI,KAAK/B,kBAAL,KAA4B,CAAC,CAAjC,EAAoC;AACvC,WAAKlB,YAAL,CAAkBgD,cAAlB,CAAiC,KAAK9B,kBAAtC,EAA0D+B,WAA1D;AACH;AACJ;;AAEDC,EAAAA,0BAA0B,CAACC,KAAK,GAAG,EAAT,EAAaC,EAAE,GAAG,EAAlB,EAC1B;AACID,IAAAA,KAAK,CAACjB,IAAN,GAAa,0BAA0BkB,EAAvC;AACA,WAAO,IAAItE,KAAK,CAACuE,KAAV,CAAgBF,KAAhB,CAAP;AACH;AAED;AACJ;AACA;;;AACIzB,EAAAA,oBAAoB,GACpB;AACI,QAAI4B,SAAS,GAAG,KAAK7C,MAAL,CAAY8C,IAAZ,CAAkBC,IAAD,IAAU;AACvC,aAAOA,IAAI,CAACC,OAAL,CAAa,YAAb,KAA8BD,IAAI,CAACC,OAAL,CAAa,cAAb,CAArC;AACH,KAFe,CAAhB;;AAGAH,IAAAA,SAAS,CAACI,OAAV,CAAkBC,QAAQ,IAAI;AAAEA,MAAAA,QAAQ,CAACC,GAAT,CAAa,UAAb;AAA2B,KAA3D;AACH;AAED;AACJ;AACA;;;AACIjC,EAAAA,qBAAqB,GACrB;AACI,QAAI2B,SAAS,GAAG,KAAK7C,MAAL,CAAY8C,IAAZ,CAAkBC,IAAD,IAAU;AACvC,aAAOA,IAAI,CAACC,OAAL,CAAa,YAAb,KAA8BD,IAAI,CAACC,OAAL,CAAa,OAAb,CAArC;AACH,KAFe,CAAhB;;AAGAH,IAAAA,SAAS,CAACI,OAAV,CAAkBG,SAAS,IAAI;AAAEA,MAAAA,SAAS,CAACD,GAAV,CAAc,UAAd;AAA4B,KAA7D;AACH;;AAEDhC,EAAAA,uBAAuB,GACvB;AACI,QAAI0B,SAAS,GAAG,KAAK7C,MAAL,CAAY8C,IAAZ,CAAkBC,IAAD,IAAU;AACvC,aAAOA,IAAI,CAACC,OAAL,CAAa,SAAb,CAAP;AACH,KAFe,CAAhB;;AAGAH,IAAAA,SAAS,CAACI,OAAV,CAAkBI,KAAK,IAAI;AAAEA,MAAAA,KAAK,CAACF,GAAN,CAAU,UAAV;AAAwB,KAArD;AACH;;AAEDG,EAAAA,YAAY,CAAC;AAACC,IAAAA,CAAD;AAAIC,IAAAA,CAAJ;AAAO3E,IAAAA,KAAP;AAAcD,IAAAA,MAAd;AAAsB6E,IAAAA,GAAtB;AAA2BJ,IAAAA;AAA3B,GAAD,EACZ;AACI,QAAIK,KAAK,GAAG,IAAIC,KAAJ,EAAZ;AAAA,QAAyBC,WAAW,GAAG,IAAIvF,KAAK,CAACsF,KAAV,EAAvC;AAAA,QACIE,UAAU,GAAG,IAAIxF,KAAK,CAACuE,KAAV,EADjB;;AAGAc,IAAAA,KAAK,CAACI,MAAN,GAAe,MAAM;AACjBF,MAAAA,WAAW,CAACG,QAAZ,CAAqB;AACjBR,QAAAA,CAAC,EAAEA,CADc;AAEjBC,QAAAA,CAAC,EAAEA,CAFc;AAGjB5E,QAAAA,MAAM,EAAEA,MAHS;AAIjBC,QAAAA,KAAK,EAAEA,KAJU;AAKjB6E,QAAAA,KAAK,EAAEA,KALU;AAMjBM,QAAAA,OAAO,EAAE,CANQ;AAOjBC,QAAAA,MAAM,EAAE,OAPS;AAQjBC,QAAAA,WAAW,EAAE;AARI,OAArB;AAUAN,MAAAA,WAAW,CAACO,KAAZ;AACAP,MAAAA,WAAW,CAACQ,OAAZ,CAAoB,CAChB/F,KAAK,CAACgG,OAAN,CAAcC,QADE,EAEhBjG,KAAK,CAACgG,OAAN,CAAcE,QAFE,EAGhBlG,KAAK,CAACgG,OAAN,CAAcG,IAHE,CAApB;AAMAZ,MAAAA,WAAW,CAACa,UAAZ,CAAuB,CAAvB;AACAb,MAAAA,WAAW,CAACc,UAAZ,CAAuB,CAAvB;AACAd,MAAAA,WAAW,CAACe,QAAZ,CAAqB,CAArB;;AAEA,WAAKxE,KAAL,CAAWyE,SAAX;;AACAlB,MAAAA,KAAK,CAACI,MAAN,GAAe,IAAf;AACH,KAxBD;;AA0BAJ,IAAAA,KAAK,CAACD,GAAN,GAAYA,GAAZ;AACAI,IAAAA,UAAU,CAAChD,GAAX,CAAe+C,WAAf;AACAP,IAAAA,KAAK,CAACxC,GAAN,CAAUgD,UAAV;;AACA,SAAKrE,gBAAL,CAAsBqF,UAAtB,CAAiC;AAC7BC,MAAAA,IAAI,EAAE,OADuB;AAE7BC,MAAAA,OAAO,EAAEnB,WAFoB;AAG7BP,MAAAA,KAAK,EAAEQ;AAHsB,KAAjC;AAKH;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACImB,EAAAA,SAAS,CAACC,IAAD,EAAOC,MAAM,GAAG,CAAhB,EACT;AACI,QAAID,IAAI,KAAK,OAAT,IAAoBC,MAAM,KAAK,GAAnC,EAAwC,OAAO,WAAP,CAAxC,KACK,IAAID,IAAI,KAAK,oBAAb,EAAmC;AACpC,cAAQC,MAAR;AACI,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV;AAAS,iBAAO,YAAP;AARb;AAUH,KAXI,MAWE,IAAID,IAAI,KAAK,YAAb,EAA2B,OAAO,gBAAP,CAA3B,KACF,IAAIA,IAAI,KAAK,WAAb,EAA0B,OAAO,WAAP,CAA1B,KACA,IAAIA,IAAI,KAAK,QAAb,EAAuB;AACxB,cAAOC,MAAP;AACI,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV,aAAK,GAAL;AAAU,iBAAO,YAAP;;AACV;AAAS,iBAAO,YAAP;AAPb;AASH;AACJ;AAED;AACJ;AACA;;;AACIpE,EAAAA,eAAe,GACf;AACI,QAAIqE,GAAG,GAAG,IAAI9G,KAAK,CAAC+G,IAAV,CAAe;AACrB7B,MAAAA,CAAC,EAAE,CADkB;AAErBC,MAAAA,CAAC,EAAE,CAFkB;AAGrB3E,MAAAA,KAAK,EAAE,KAAKmB,MAAL,CAAYnB,KAAZ,EAHc;AAIrBD,MAAAA,MAAM,EAAE,KAAKoB,MAAL,CAAYpB,MAAZ,EAJa;AAKrByG,MAAAA,IAAI,EAAE,OALe;AAMrBpB,MAAAA,MAAM,EAAE;AANa,KAAf,CAAV;;AAQA,SAAK9D,KAAL,CAAWU,GAAX,CAAesE,GAAf;;AACAA,IAAAA,GAAG,CAACG,YAAJ;AACH;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACIC,EAAAA,aAAa,CAACC,IAAD,EAAOC,QAAP,EAAiBC,UAAjB,EACb;AACI,QAAIC,MAAM,GAAGhE,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb;AACA,QAAIgE,GAAG,GAAGD,MAAM,CAACE,UAAP,CAAkB,IAAlB,CAAV;AAEAD,IAAAA,GAAG,CAACX,IAAJ,GAAWQ,QAAQ,GAAG,KAAX,GAAmBC,UAA9B;AACA,QAAII,MAAM,GAAGF,GAAG,CAACG,WAAJ,CAAgBP,IAAhB,EAAsB3G,KAAnC;AACA8G,IAAAA,MAAM,CAACxD,MAAP;AAEA,WAAO2D,MAAP;AACH;AACD;AACJ;AACA;AACA;;;AACIE,EAAAA,aAAa,CAACnH,KAAD,EAAQoH,MAAR,EACb;AACI,WAAOA,MAAM,GAAIpH,KAAK,GAAG,CAAzB;AACH;AAED;AACJ;AACA;AACA;AACA;;;AACIqH,EAAAA,cAAc,GACd;AACI,SAAKC,WAAL;;AACA,SAAKC,kBAAL;;AACA,SAAKC,iBAAL;;AACA,SAAKC,oBAAL,GAJJ,CAKI;;AACH;AAED;AACJ;AACA;AACA;AACA;;;AACIH,EAAAA,WAAW,GACX;AACI,QAAII,UAAU,GAAG5E,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB;AACA2E,IAAAA,UAAU,CAACC,KAAX,CAAiBC,QAAjB,GAA4B,UAA5B;AACA9E,IAAAA,QAAQ,CAAC+E,cAAT,CAAwB,cAAxB,EAAwC1E,WAAxC,CAAoDuE,UAApD;;AAEA,SAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKpH,YAAL,CAAkBqH,OAAlB,EAApB,EAAiDD,CAAC,EAAlD,EAAsD;AAClDJ,MAAAA,UAAU,CAACvE,WAAX,CAAuB,KAAKzC,YAAL,CAAkBsH,WAAlB,CAA8BF,CAA9B,CAAvB;;AACA,WAAKG,aAAL,CAAmB,eAAnB,EAAoCH,CAApC;;AACA,WAAKpH,YAAL,CAAkBsH,WAAlB,CAA8BF,CAA9B,EAAiCxE,MAAjC;AACH;;AACDoE,IAAAA,UAAU,CAACpE,MAAX;AACH;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACI2E,EAAAA,aAAa,CAACC,KAAD,EAAQC,KAAR,EACb;AACI,QAAIC,OAAO,GAAGtF,QAAQ,CAACuF,aAAT,CAAuBH,KAAvB,CAAd,CADJ,CAEI;;AACAzI,IAAAA,WAAW,CAAC2I,OAAD,EAAU;AACjBE,MAAAA,OAAO,EAAE,KADQ;AAEjBC,MAAAA,eAAe,EAAE,IAFA;AAGjBC,MAAAA,OAAO,EAAE,CAAEC,MAAM,CAACD,OAHD,CAIjB;;AAJiB,KAAV,CAAX,CAKGE,IALH,CAKS7D,KAAD,IAAW;AACf;AACA,WAAKnE,YAAL,CAAkBiI,QAAlB,CAA2BR,KAA3B,EAAkCtD,KAAlC,CAAwCA,KAAxC;;AACA,WAAKvD,KAAL,CAAWyE,SAAX;AACH,KATD,EASG6C,KATH,CASS,MAAM;AACX,UAAIlB,UAAU,GAAG5E,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAjB;AACA2E,MAAAA,UAAU,CAACC,KAAX,CAAiBC,QAAjB,GAA4B,UAA5B;AACA9E,MAAAA,QAAQ,CAAC+E,cAAT,CAAwB,cAAxB,EAAwC1E,WAAxC,CAAoDuE,UAApD;AAEAA,MAAAA,UAAU,CAACvE,WAAX,CAAuB,KAAKzC,YAAL,CAAkBsH,WAAlB,CAA8BG,KAA9B,CAAvB;;AACA,WAAKF,aAAL,CAAmB,eAAnB,EAAoCE,KAApC;;AACA,WAAKzH,YAAL,CAAkBsH,WAAlB,CAA8BG,KAA9B,EAAqC7E,MAArC;;AACAoE,MAAAA,UAAU,CAACpE,MAAX;AACH,KAlBD;AAmBA;AACR;AACA;AACA;AACK;AAED;AACJ;AACA;AACA;AACA;AACA;;;AACIkE,EAAAA,iBAAiB,GACjB;AACI,QAAIxD,SAAS,GAAG,KAAK7C,MAAL,CAAY8C,IAAZ,CAAkBC,IAAD,IAAU;AACvC,aAAOA,IAAI,CAACC,OAAL,CAAa,YAAb,KAA8BD,IAAI,CAACC,OAAL,CAAa,cAAb,CAArC;AACH,KAFe,CAAhB;;AAIAH,IAAAA,SAAS,CAACI,OAAV,CAAmBC,QAAD,IAAc;AAC5BA,MAAAA,QAAQ,CAACwE,EAAT,CAAY,UAAZ,EAAwB,MAAM;AAC1BxE,QAAAA,QAAQ,CAACyE,OAAT,CAAiB,WAAjB,EAA8B,IAA9B;;AAEA,aAAKlI,GAAL,CAASE,KAAT,CAAe,CAACuD,QAAD,CAAf;;AACA,aAAKzD,GAAL,CAASmI,SAAT;;AACA,aAAKzH,KAAL,CAAWyE,SAAX;;AAEA,aAAKnE,kBAAL,GAA0ByC,QAAQ,CAAC2E,OAAT,CAAiB,IAAjB,CAA1B;AACA,aAAKnH,mBAAL,GAA2B,KAAKD,kBAAhC;;AAEA,aAAKH,aAAL,CAAmB,KAAKf,YAAL,CAAkBuI,cAAlB,CAAiC,KAAKrH,kBAAtC,CAAnB;;AACA,aAAKJ,cAAL,CAAoB,aAApB;;AAEA0H,QAAAA,UAAU,CAAC,MAAM;AACb,eAAK/H,MAAL,CAAY0H,EAAZ,CAAe,OAAf,EAAwBM,kBAAxB;AACH,SAFS,CAAV;;AAIA,YAAIA,kBAAkB,GAAIC,CAAD,IAAO;AAC5B,cAAIA,CAAC,CAACC,MAAF,KAAahF,QAAjB,EAA2B;AACvB,iBAAKzC,kBAAL,GAA0B,CAAC,CAA3B;;AACA,iBAAKJ,cAAL,CAAoB,MAApB;;AACA,iBAAKZ,GAAL,CAASE,KAAT,CAAe,EAAf;;AACAuD,YAAAA,QAAQ,CAACyE,OAAT,CAAiB,WAAjB,EAA8B,KAA9B;;AACA,iBAAKxH,KAAL,CAAWyE,SAAX;;AACA,iBAAK5E,MAAL,CAAYmD,GAAZ,CAAgB,OAAhB,EAAyB6E,kBAAzB;AACH;AACJ,SATD;AAUH,OA3BD;AA6BA9E,MAAAA,QAAQ,CAACwE,EAAT,CAAY,SAAZ,EAAuB,MAAM;AACzB,aAAKS,sBAAL,CAA4BjF,QAA5B;AACH,OAFD;AAGH,KAjCD;AAkCH;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACIkF,EAAAA,iBAAiB,CAAClF,QAAD,EACjB;AACI,QAAIA,QAAQ,CAACQ,KAAT,KAAmBtE,SAAnB,IAAgC8D,QAAQ,CAACA,QAAT,KAAsB9D,SAAtD,IACA8D,QAAQ,CAACG,KAAT,KAAmBjE,SADnB,IACgC8D,QAAQ,CAACmF,OAAT,KAAqBjJ,SADrD,IAEA8D,QAAQ,KAAK,CAFjB,EAEoB;AAChB;AACH;;AACD,SAAK3D,YAAL,CAAkB+I,cAAlB,CAAiC;AAC7BtB,MAAAA,KAAK,EAAE,KAAKtG,mBADiB;AAE7BwC,MAAAA,QAAQ,EAAEA,QAAQ,CAACA,QAFU;AAG7BG,MAAAA,KAAK,EAAEH,QAAQ,CAACG,KAHa;AAI7BK,MAAAA,KAAK,EAAER,QAAQ,CAACQ,KAJa;AAK7B2E,MAAAA,OAAO,EAAEnF,QAAQ,CAACmF;AALW,KAAjC;;AAOA,SAAK3H,mBAAL,GAA2B,CAAC,CAA5B;AACH;;AAED6H,EAAAA,MAAM,GACN;AACI;AACA,QAAI,KAAK5H,mBAAL,KAA6B,CAAC,CAAlC,EAAqC;AACjC,WAAKlB,GAAL,CAASE,KAAT,CAAe,EAAf;;AACA,WAAKQ,KAAL,CAAWyE,SAAX;;AACA,WAAKtF,aAAL,CAAmBkJ,iBAAnB,CAAqC,KAAK7H,mBAA1C;;AACA,WAAKA,mBAAL,GAA2B,CAAC,CAA5B;AACH,KALD,MAKO,IAAI,KAAKF,kBAAL,KAA4B,CAAC,CAAjC,EAAoC;AACvC,WAAKhB,GAAL,CAASE,KAAT,CAAe,EAAf;;AACA,WAAKQ,KAAL,CAAWyE,SAAX;;AACA,WAAKrF,YAAL,CAAkBiJ,iBAAlB,CAAoC,KAAK/H,kBAAzC;;AACA,WAAKE,mBAAL,GAA2B,CAAC,CAA5B;AACH,KALM,MAKA,IAAI,KAAKC,qBAAL,KAA+B,CAAC,CAApC,EAAuC;AAC1C,WAAKnB,GAAL,CAASE,KAAT,CAAe,EAAf;;AACA,WAAKQ,KAAL,CAAWyE,SAAX;;AACA,WAAKpF,gBAAL,CAAsBgJ,iBAAtB,CAAwC,KAAK5H,qBAA7C;;AACA,WAAKA,qBAAL,GAA6B,CAAC,CAA9B;AACH;AACJ;;AAED6H,EAAAA,qBAAqB,CAACC,QAAD,EACrB;AACI,QAAIA,QAAQ,KAAK,CAAb,IAAkB,KAAK/H,mBAAL,KAA6B,CAAC,CAApD,EAAuD;;AACvD,SAAKrB,aAAL,CAAmBmJ,qBAAnB,CAAyC,KAAK9H,mBAA9C,EAAmE+H,QAAnE;AACH;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACIC,EAAAA,eAAe,CAACC,SAAD,EACf;AACI,QAAIA,SAAS,KAAK,CAAd,IAAmB,KAAKjI,mBAAL,KAA6B,CAAC,CAArD,EAAwD;;AACxD,QAAIkI,IAAI,GAAG,KAAKvJ,aAAL,CAAmBwI,cAAnB,CAAkC,KAAKnH,mBAAvC,CAAX;AAAA,QACIc,IAAI,GAAGoH,IAAI,CAACxF,KAAL,CAAWwE,OAAX,CAAmB,MAAnB,CADX;;AAEA,QAAIpG,IAAI,KAAK,yBAAb,EAAwC;AACpC;AACA;AACA;AACA;AACA,UAAImH,SAAS,CAACE,SAAV,KAAwB,CAAxB,IAA6BF,SAAS,CAACG,WAAV,KAA0B,CAA3D,EAA8D;AAC9D,UAAID,SAAS,GAAGF,SAAS,CAACE,SAA1B;AAAA,UAAqCC,WAAW,GAAGH,SAAS,CAACG,WAA7D;AACAF,MAAAA,IAAI,CAACG,KAAL,CAAWC,UAAX,CAAsBC,QAAQ,CAACJ,SAAD,CAA9B,EAA2CI,QAAQ,CAACH,WAAD,CAAnD;AACH,KARD,MAQO;AACH;AACA;AACA;AACA;AACAF,MAAAA,IAAI,CAACG,KAAL,CAAWC,UAAX,CAAsBL,SAAtB;AACH;;AAED,SAAKO,iBAAL,CAAuBN,IAAvB;AACH;;AAEDO,EAAAA,mBAAmB,CAACV,QAAD,EACnB;AACI,QAAIA,QAAQ,KAAK,CAAb,IAAkB,KAAK/H,mBAAL,KAA6B,CAAC,CAApD,EAAuD;;AACvD,QAAIkI,IAAI,GAAG,KAAKvJ,aAAL,CAAmBwI,cAAnB,CAAkC,KAAKnH,mBAAvC,CAAX;;AACAkI,IAAAA,IAAI,CAACG,KAAL,CAAWI,mBAAX,CAA+BV,QAA/B;;AACA,SAAKS,iBAAL,CAAuBN,IAAvB;AACH;;AAEDQ,EAAAA,qBAAqB,CAACX,QAAD,EACrB;AACI,QAAIA,QAAQ,KAAK,CAAb,IAAkB,KAAK9H,qBAAL,KAA+B,CAAC,CAAtD,EAAyD;;AACzD,SAAKpB,gBAAL,CAAsB6J,qBAAtB,CAA4C;AACxC1G,MAAAA,EAAE,EAAE,KAAK/B,qBAD+B;AAExC8H,MAAAA,QAAQ,EAACA;AAF+B,KAA5C;;AAIA,SAAKjJ,GAAL,CAAS6J,WAAT;;AACA,SAAKnJ,KAAL,CAAWyE,SAAX;AACH;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACIuE,EAAAA,iBAAiB,CAACI,WAAD,EACjB;AACI,QAAIC,IAAI,GAAGD,WAAW,CAACP,KAAvB;;AACA,SAAK,IAAIrC,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAI4C,WAAW,CAACE,aAAjC,EAAgD9C,CAAC,EAAjD,EAAqD;AACjD4C,MAAAA,WAAW,CAACG,UAAZ,CAAuB/C,CAAvB,EAA0BgD,eAA1B,CAA0CH,IAA1C;AACAA,MAAAA,IAAI,GAAGD,WAAW,CAACG,UAAZ,CAAuB/C,CAAvB,CAAP;AACH;;AACD6C,IAAAA,IAAI,CAACI,WAAL;;AACA,SAAKnK,GAAL,CAAS6J,WAAT;;AACA,SAAKnJ,KAAL,CAAWyE,SAAX;AACH;AAED;AACJ;AACA;AACA;AACA;;;AACIwB,EAAAA,kBAAkB,GAClB;AACI,QAAIvD,SAAS,GAAG,KAAK7C,MAAL,CAAY8C,IAAZ,CAAkBC,IAAD,IAAU;AACvC,aAAOA,IAAI,CAACC,OAAL,CAAa,YAAb,KAA8BD,IAAI,CAACC,OAAL,CAAa,OAAb,CAArC;AACH,KAFe,CAAhB;;AAGAH,IAAAA,SAAS,CAACI,OAAV,CAAmB+F,KAAD,IAAW;AACzB;AACZ;AACA;AACYA,MAAAA,KAAK,CAACtB,EAAN,CAAS,UAAT,EAAqB,MAAM;AACvB,aAAK/G,mBAAL,GAA2BuI,QAAQ,CAACF,KAAK,CAACnB,OAAN,CAAc,IAAd,CAAD,CAAnC;;AACA,aAAKpI,GAAL,CAASE,KAAT,CAAe,CAACqJ,KAAD,CAAf;;AACA,aAAKvJ,GAAL,CAASmI,SAAT;;AACA,aAAKzH,KAAL,CAAWyE,SAAX;;AACAoE,QAAAA,KAAK,CAACrB,OAAN,CAAc,WAAd,EAA2B,IAA3B;;AAEA,YAAIkC,aAAa,GAAG,KAAKvK,aAAL,CAAmBwI,cAAnB,CAAkC,KAAKnH,mBAAvC,EAA4DqI,KAAhF;AAAA,YACIc,SAAS,GAAG,KAAKxK,aAAL,CAAmByK,yBAAnB,CAA6C,KAAKpJ,mBAAlD,CADhB;;AAEA,aAAKJ,cAAL,CAAoBsJ,aAAa,CAACG,OAAd,EAApB,EAA6CH,aAAa,CAACI,gBAAd,EAA7C,EAA+EH,SAA/E;;AAEA,YAAId,KAAK,CAACnB,OAAN,CAAc,MAAd,MAA0B,yBAA9B,EAAyD;AACrD,eAAKxH,cAAL,CAAoB,eAApB;AACH,SAFD,MAEO,IAAI2I,KAAK,CAACnB,OAAN,CAAc,MAAd,MAA0B,sBAA9B,EAAsD;AACzD,eAAKxH,cAAL,CAAoB,YAApB;AACH,SAFM,MAEA,IAAI2I,KAAK,CAACnB,OAAN,CAAc,MAAd,MAA0B,sBAA9B,EAAsD;AACzD,eAAKxH,cAAL,CAAoB,YAApB;AACH,SAFM,MAEA,IAAI2I,KAAK,CAACnB,OAAN,CAAc,MAAd,MAA0B,0BAA9B,EAA0D;AAC7D,eAAKxH,cAAL,CAAoB,oBAApB;AACH,SAFM,MAEA,IAAI2I,KAAK,CAACnB,OAAN,CAAc,MAAd,MAA0B,uBAA9B,EAAuD;AAC1D,eAAKxH,cAAL,CAAoB,aAApB;AACH,SAFM,MAEA,IAAI2I,KAAK,CAACnB,OAAN,CAAc,MAAd,MAA0B,uBAA9B,EAAuD;AAC1D,eAAKxH,cAAL,CAAoB,iBAApB;AACH,SAFM,MAEA,IAAI2I,KAAK,CAACnB,OAAN,CAAc,MAAd,MAA0B,wBAA9B,EAAwD;AAC3D,eAAKxH,cAAL,CAAoB,cAApB;AACH;;AAED0H,QAAAA,UAAU,CAAC,MAAM;AACb,eAAK/H,MAAL,CAAY0H,EAAZ,CAAe,OAAf,EAAwBM,kBAAxB;AACH,SAFS,CAAV;;AAIA,YAAIA,kBAAkB,GAAIC,CAAD,IAAO;AAC5B,cAAIA,CAAC,CAACC,MAAF,KAAac,KAAjB,EAAwB;AACpB,iBAAKrI,mBAAL,GAA2B,CAAC,CAA5B;;AACA,iBAAKN,cAAL,CAAoB,MAApB;;AACA,iBAAKZ,GAAL,CAASE,KAAT,CAAe,EAAf;;AACAqJ,YAAAA,KAAK,CAACrB,OAAN,CAAc,WAAd,EAA2B,KAA3B;;AACA,iBAAKxH,KAAL,CAAWyE,SAAX;;AACA,iBAAK5E,MAAL,CAAYmD,GAAZ,CAAgB,OAAhB,EAAyB6E,kBAAzB;AACH;AACJ,SATD;AAUH,OAzCD;AA2CAgB,MAAAA,KAAK,CAACtB,EAAN,CAAS,SAAT,EAAoB,MAAM;AACtB,aAAKS,sBAAL,CAA4Ba,KAA5B;AACH,OAFD;AAGH,KAlDD;AAmDH;;AAED1C,EAAAA,oBAAoB,GACpB;AACI,QAAIzD,SAAS,GAAG,KAAK7C,MAAL,CAAY8C,IAAZ,CAAkBC,IAAD,IAAU;AACvC,aAAOA,IAAI,CAACC,OAAL,CAAa,SAAb,CAAP;AACH,KAFe,CAAhB;;AAIAH,IAAAA,SAAS,CAACI,OAAV,CAAmBI,KAAD,IAAW;AACzBA,MAAAA,KAAK,CAACqE,EAAN,CAAS,UAAT,EAAqB,MAAM;AACvB,aAAK9G,qBAAL,GAA6ByC,KAAK,CAACwE,OAAN,CAAc,IAAd,CAA7B;;AACA,YAAI/C,IAAI,GAAG,KAAKtF,gBAAL,CAAsB0K,OAAtB,CAA8B,KAAKtJ,qBAAnC,CAAX;;AACA,aAAKnB,GAAL,CAASE,KAAT,CAAe,CAAC0D,KAAD,CAAf;;AACA,aAAK5D,GAAL,CAASmI,SAAT;;AACA,aAAKzH,KAAL,CAAWyE,SAAX;;AACAvB,QAAAA,KAAK,CAACsE,OAAN,CAAc,WAAd,EAA2B,IAA3B;;AAEA,aAAKtH,cAAL,CAAoByE,IAAI,GAAG,SAA3B;;AAEA,aAAKtE,gBAAL,CACI,KAAKhB,gBAAL,CAAsB2K,WAAtB,CAAkC,KAAKvJ,qBAAvC,CADJ;;AAIAmH,QAAAA,UAAU,CAAC,MAAM;AACb,eAAK/H,MAAL,CAAY0H,EAAZ,CAAe,OAAf,EAAwBM,kBAAxB;AACH,SAFS,CAAV;;AAIA,YAAIA,kBAAkB,GAAIC,CAAD,IAAO;AAC5B,cAAIA,CAAC,CAACC,MAAF,KAAa7E,KAAjB,EAAwB;AACpB,iBAAKzC,qBAAL,GAA6B,CAAC,CAA9B;;AACA,iBAAKnB,GAAL,CAASE,KAAT,CAAe,EAAf;;AACA0D,YAAAA,KAAK,CAACsE,OAAN,CAAc,WAAd,EAA2B,KAA3B;;AACA,iBAAKxH,KAAL,CAAWyE,SAAX;;AACA,iBAAKvE,cAAL,CAAoB,MAApB;;AACA,iBAAKL,MAAL,CAAYmD,GAAZ,CAAgB,OAAhB,EAAyB6E,kBAAzB;AACH;AACJ,SATD;AAUH,OA5BD;AA8BA3E,MAAAA,KAAK,CAACqE,EAAN,CAAS,SAAT,EAAoB,MAAM;AACtB,aAAKS,sBAAL,CAA4B9E,KAA5B;AACH,OAFD;AAGH,KAlCD;AAmCH;;AAED8E,EAAAA,sBAAsB,CAACU,IAAD,EACtB;AACI,QAAIhG,SAAS,GAAG,KAAK7C,MAAL,CAAY8C,IAAZ,CAAkBC,IAAD,IAAU;AACvC,aAAOA,IAAI,CAACC,OAAL,CAAa,YAAb,KAA8BD,IAAI,CAACC,OAAL,CAAa,WAAb,CAArC;AACH,KAFe,CAAhB;AAAA,QAGIoH,MAAM,GAAG,KAAKC,iBAAL,CAAuBxB,IAAvB,CAHb;;AAKAhG,IAAAA,SAAS,GAAGA,SAAS,CAACyH,MAAV,CAAiBC,CAAC,IAAIH,MAAM,KAAKG,CAAjC,CAAZ;AAEA1H,IAAAA,SAAS,CAACI,OAAV,CAAkBI,KAAK,IAAI;AACvB,UAAIhF,KAAK,CAACmM,IAAN,CAAWC,gBAAX,CAA4BpH,KAAK,CAACqH,aAAN,EAA5B,EAAmD7B,IAAI,CAAC6B,aAAL,EAAnD,CAAJ,EAA8E;AAC1E,YAAIC,MAAM,GAAG9B,IAAI,CAAC+B,mBAAL,EAAb;AACA/B,QAAAA,IAAI,CAACgC,MAAL,CAAYxH,KAAZ;AACAwF,QAAAA,IAAI,CAACiC,gBAAL,CAAsB;AAClBvH,UAAAA,CAAC,EAAEoH,MAAM,CAACpH,CADQ;AAElBC,UAAAA,CAAC,EAAEmH,MAAM,CAACnH;AAFQ,SAAtB;AAIH;AACJ,KATD;AAUH;;AAED6G,EAAAA,iBAAiB,CAACxB,IAAD,EACjB;AACI,QAAIuB,MAAM,GAAGvB,IAAI,CAACkC,SAAL,EAAb;;AACA,WAAOX,MAAM,CAACY,QAAP,GAAkB,CAAlB,IAAuB,CAACZ,MAAM,CAACpH,OAAP,CAAe,YAAf,CAA/B,EAA6D;AACzDoH,MAAAA,MAAM,GAAGA,MAAM,CAACW,SAAP,EAAT;AACH;;AACD,WAAOX,MAAP;AACH;;AAEDa,EAAAA,2BAA2B,GAC3B;AACI,SAAK9K,KAAL,CAAWU,GAAX,CAAe,KAAKqK,mBAApB;;AACA,SAAKC,sBAAL;;AACA,SAAKC,qBAAL;;AACA,SAAKC,oBAAL;;AACA,SAAKC,yBAAL;AACH;;AAEDH,EAAAA,sBAAsB,GACtB;AACI,SAAKnL,MAAL,CAAY0H,EAAZ,CAAe,sBAAf,EAAuCO,CAAC,IAAI;AACxC;AACA,WAAKsD,YAAL,GAAoB,IAApB;AAEA,WAAKC,QAAL,GAAgB,KAAKxL,MAAL,CAAYyL,kBAAZ,GAAiClI,CAAjD;AACA,WAAKmI,QAAL,GAAgB,KAAKF,QAArB;AACA,WAAKG,QAAL,GAAgB,KAAK3L,MAAL,CAAYyL,kBAAZ,GAAiCjI,CAAjD;AACA,WAAKoI,QAAL,GAAgB,KAAKD,QAArB;;AAEA,WAAKT,mBAAL,CAAyBW,OAAzB,CAAiC,IAAjC;;AACA,WAAKX,mBAAL,CAAyBrM,KAAzB,CAA+B,CAA/B;;AACA,WAAKqM,mBAAL,CAAyBtM,MAAzB,CAAgC,CAAhC;;AACA,WAAKuB,KAAL,CAAWyE,SAAX;AACH,KAbD;AAcH;;AAEDwG,EAAAA,qBAAqB,GACrB;AACI,SAAKpL,MAAL,CAAY0H,EAAZ,CAAe,qBAAf,EAAsC,MAAM;AACxC,UAAI,CAAC,KAAKwD,mBAAL,CAAyBW,OAAzB,EAAL,EAAyC;AAEzC,WAAKH,QAAL,GAAgB,KAAK1L,MAAL,CAAYyL,kBAAZ,GAAiClI,CAAjD;AACA,WAAKqI,QAAL,GAAgB,KAAK5L,MAAL,CAAYyL,kBAAZ,GAAiCjI,CAAjD;;AAEA,WAAK0H,mBAAL,CAAyBnH,QAAzB,CAAkC;AAC9BR,QAAAA,CAAC,EAAEuI,IAAI,CAACC,GAAL,CAAS,KAAKP,QAAd,EAAwB,KAAKE,QAA7B,CAD2B;AAE9BlI,QAAAA,CAAC,EAAEsI,IAAI,CAACC,GAAL,CAAS,KAAKJ,QAAd,EAAwB,KAAKC,QAA7B,CAF2B;AAG9B/M,QAAAA,KAAK,EAAEiN,IAAI,CAACE,GAAL,CAAS,KAAKN,QAAL,GAAgB,KAAKF,QAA9B,CAHuB;AAI9B5M,QAAAA,MAAM,EAAEkN,IAAI,CAACE,GAAL,CAAS,KAAKJ,QAAL,GAAgB,KAAKD,QAA9B;AAJsB,OAAlC;;AAOA,WAAKxL,KAAL,CAAWyE,SAAX;AACH,KAdD;AAeH;;AAEDyG,EAAAA,oBAAoB,GACpB;AACI,SAAKrL,MAAL,CAAY0H,EAAZ,CAAe,kBAAf,EAAmC,MAAM;AACrC,UAAI,CAAC,KAAKwD,mBAAL,CAAyBW,OAAzB,EAAL,EAAyC,OADJ,CAErC;;AACA,UAAII,KAAK,GAAG,KAAKjM,MAAL,CAAY8C,IAAZ,CAAiB,aAAjB,EAAgCoJ,OAAhC,EAAZ;;AACA,UAAIC,GAAG,GAAG,KAAKjB,mBAAL,CAAyBR,aAAzB,EAAV;AACA;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEY,UAAI0B,QAAQ,GAAGH,KAAK,CAAC3B,MAAN,CAAczB,IAAD,IACxBxK,KAAK,CAACmM,IAAN,CAAWC,gBAAX,CAA4B0B,GAA5B,EAAiCtD,IAAI,CAAC6B,aAAL,EAAjC,CADW,CAAf;AAGA2B,MAAAA,OAAO,CAACC,GAAR,CAAYF,QAAZ;;AAEA,WAAK3M,GAAL,CAASE,KAAT,CAAeyM,QAAf;;AACA,WAAK3M,GAAL,CAASmI,SAAT;;AACA,WAAKzH,KAAL,CAAWyE,SAAX;;AAEAmD,MAAAA,UAAU,CAAC,MAAM;AACb,aAAKmD,mBAAL,CAAyBW,OAAzB,CAAiC,KAAjC;;AACA,aAAK1L,KAAL,CAAWyE,SAAX;;AACA,aAAK2H,YAAL,GAAoB,IAApB;AACA,aAAKhB,YAAL,GAAoB,KAApB;AACH,OALS,CAAV;AAMH,KAtCD;AAuCH;;AAEDD,EAAAA,yBAAyB,GACzB;AACI,SAAKtL,MAAL,CAAY0H,EAAZ,CAAe,WAAf,EAA4BO,CAAC,IAAI;AAC7B,UAAI,KAAKiD,mBAAL,CAAyBW,OAAzB,EAAJ,EAAwC;;AACxC,UAAI,KAAKU,YAAT,EAAuB;AACnB,aAAKC,SAAL,CAAevJ,OAAf,CAAuBF,IAAI,IAAI;AAC3BA,UAAAA,IAAI,CAAC4E,OAAL,CAAa,WAAb,EAA0B,KAA1B;AACH,SAFD;;AAIA,aAAKlI,GAAL,CAASE,KAAT,CAAe,EAAf;;AACA,aAAKQ,KAAL,CAAWyE,SAAX;;AACA,aAAK2H,YAAL,GAAoB,KAApB;AACA;AACH;AACJ,KAZD;AAaH;;AA5wBL;;AA+wBA,SAAS7N,YAAT","sourcesContent":["// Cullen, Riley\n// AInfographic.js\n// October 26, 2020 \n\nimport Konva from 'konva';\nimport html2canvas from 'html2canvas';\nimport { ChartHandler, GraphicsHandler, TextHandler } from '../Handlers/index';\n\nclass AInfographic \n{\n    /**\n     * @summary     An abstract class the provide structure and common functionality\n     *              to the Infographic type.\n     * @description See summary.\n     * \n     * @requires D3.js\n     * @requires Konva.js\n     * \n     * @source _AddTextSelection() uses code from https://konvajs.org/docs/sandbox/Editable_Text.html\n     * @source Selecting mutliple elements demo uses code from https://konvajs.org/docs/select_and_transform/Basic_demo.html#page-title\n     * @source _DrawSVG code taken from https://konvajs.org/docs/sandbox/SVG_On_Canvas.html\n     * @source Download code taken from https://konvajs.org/docs/data_and_serialization/High-Quality-Export.html\n     * \n     * @param {double} height The height of the canvas element\n     * @param {double} width  The width of the canvas element\n     */\n    constructor(height, width, editorHandler, textCallback, chartCallback, graphicCallback)\n    {\n        if (AInfographic === this.constructor) {\n            throw new TypeError('Abstract class \"AInfographic\" cannot be instantiated');\n        }\n\n        if (this.CreateInfographic === undefined) {\n            throw new TypeError('Types extending \"AInfographic\" must implement CreateInfographic()');\n        }\n\n        if (this.Draw === undefined) {\n            throw new TypeError('Types extending \"AInfographic\" must implement Draw()');\n        }\n\n        this._chartHandler = new ChartHandler();\n        this._textHandler = new TextHandler();\n        this._graphicsHandler = new GraphicsHandler();\n\n        this._tr = new Konva.Transformer({\n            nodes: [],\n            resizeEnabled: false,\n            rotateEnabled: false,\n        });\n\n        this._chartHeight = height;\n        this._chartWidth = width;\n        this._stage = new Konva.Stage({\n            container: 'canvas-container',\n            width: this._chartWidth,\n            height: this._chartHeight,\n        });\n\n        /*this._selectionRectangle = new Konva.Rect({\n            fill: 'rgba(0, 0, 255, 0.5)',\n            visible: false,\n        });\n        this._hasSelected = false;\n        this._isSelecting = false;\n        this._oldNodes = [];\n        this._mouseX1 = 0, this._mouseX2 = 0, this._mouseY1 = 0, this._mouseY2 = 0;*/\n\n        this._main = new Konva.Layer();\n        // this._UIAdder = new UIAdder(this._chartWidth, this._chartHeight);\n\n        this._editorHandler = editorHandler;\n        this._textCallback = textCallback;\n        this._chartCallback = chartCallback;\n        this._graphicCallback = graphicCallback;\n\n        this._selectedTextIndex = -1;\n        this._selectedTextHelper = -1;\n        this._selectedChartIndex = -1;\n        this._selectedGraphicIndex = -1;\n\n        this._stage.add(this._main);\n\n        this._main.add(this._tr);\n\n        this._AddStageBorder();\n    }\n\n    /**\n     * @summary     Returns chart's dimensions to caller.\n     * @description Returns the chart's width and height in the form of a JSON\n     *              object to the caller.\n     * @returns A JSON object containing the chart's width and height.\n     */\n    GetDimensions()\n    {\n        return {\n            width: this._chartWidth,\n            height: this._chartHeight,\n        };\n    }\n\n    /**\n     * @summary     Manages memory for infographic type.\n     * @description A function that is responsible for freeing memory that would \n     *              otherwise cause memory leaks. \n     */\n    Clean()\n    {\n        // Remove chart/text listeners\n        this._RemoveTextListeners();\n        this._RemoveChartListeners();\n        this._RemoveGraphicListeners();\n\n        // Remove all the elements from this._stage\n        this._stage.destroy();\n        this._stage = 0;\n    }\n\n    ClearSelection()\n    {\n        this._tr.nodes([]);\n        this._selectedChartIndex = -1;\n        this._selectedGraphicIndex = -1;\n        this._selectedTextIndex = this._selectedTextHelper = -1;\n    }\n\n    Download()\n    {\n        // function from https://stackoverflow.com/a/15832662/512042\n        function downloadURI(uri, name) {\n            var link = document.createElement('a');\n            link.download = name;\n            link.href = uri;\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n            link.remove();\n        }\n        var dataURL = this._stage.toDataURL({pixelRatio: 5})\n        downloadURI(dataURL, 'Infographic.png');\n    }\n\n    UpdateLayering(layerAction)\n    {\n        if (this._selectedChartIndex !== -1) {\n            this._chartHandler.UpdateLayering(this._selectedChartIndex, layerAction);\n        } else if (this._selectedGraphicIndex !== -1) {\n            this._graphicsHandler.UpdateLayering(this._selectedGraphicIndex, layerAction);\n        } else if (this._selectedTextIndex !== -1) {\n            this._textHandler.UpdateLayering(this._selectedTextIndex, layerAction);\n        }\n    }\n\n    _CreateSwitchableContainer(attrs = {}, id = '')\n    {\n        attrs.name = 'Switchable Container ' + id;\n        return new Konva.Group(attrs);\n    }\n\n    /**\n     * @summary Removes the event listeners from each text node.\n     */\n    _RemoveTextListeners()\n    {\n        var selection = this._stage.find((node) => {\n            return node.hasName('Selectable') && node.hasName('EditableText');\n        });\n        selection.forEach(textElem => { textElem.off('dblclick'); })\n    }\n\n    /**\n     * @summary Removes the event listeners from each chart node.\n     */\n    _RemoveChartListeners()\n    {\n        var selection = this._stage.find((node) => {\n            return node.hasName('Selectable') && node.hasName('Chart');\n        });\n        selection.forEach(chartElem => { chartElem.off('dblclick'); })\n    }\n\n    _RemoveGraphicListeners()\n    {\n        var selection = this._stage.find((node) => {\n            return node.hasName('Graphic');\n        });\n        selection.forEach(group => { group.off('dblclick'); });\n    }\n\n    _CreateImage({x, y, width, height, src, group})\n    {\n        let image = new Image(), imageHelper = new Konva.Image(),\n            imageGroup = new Konva.Group();\n\n        image.onload = () => {\n            imageHelper.setAttrs({\n                x: x, \n                y: y,\n                height: height,\n                width: width,\n                image: image,\n                opacity: 1,\n                stroke: 'black',\n                strokeWidth: 0\n            });\n            imageHelper.cache();\n            imageHelper.filters([\n                Konva.Filters.Contrast,\n                Konva.Filters.Brighten,\n                Konva.Filters.Blur,\n            ]);\n\n            imageHelper.brightness(0);\n            imageHelper.blurRadius(0);\n            imageHelper.contrast(0);\n\n            this._main.batchDraw();\n            image.onload = null;\n        };\n\n        image.src = src;\n        imageGroup.add(imageHelper);\n        group.add(imageGroup);\n        this._graphicsHandler.AddGraphic({\n            type: 'image',\n            graphic: imageHelper,\n            group: imageGroup,\n        });\n    }\n\n    /**\n     * @summary     A function that takes in a font and a font weight and maps it\n     *              to the proper quill code.\n     * \n     * @param {string} font   The font associated with a quill code.\n     * @param {int}    weight The weight associated with a quill code. \n     */\n    _quillMap(font, weight = 0)\n    {\n        if (font === 'museo' && weight === 900) return '900-museo';\n        else if (font === 'canada-type-gibson') {\n            switch (weight) {\n                case 100: return '100-canada';\n                case 200: return '200-canada';\n                case 400: return '400-canada';\n                case 500: return '500-canada';\n                case 600: return '600-canada';\n                case 700: return '700-canada';\n                case 900: return '900-canada';\n                default: return '100-canada';\n            }\n        } else if (font === 'Montserrat') return '200-Montserrat';\n        else if (font === 'Open Sans') return 'Open-Sans';\n        else if (font === 'Roboto') {\n            switch(weight) {\n                case 100: return '100-Roboto';\n                case 300: return '300-Roboto';\n                case 400: return '400-Roboto';\n                case 500: return '500-Roboto';\n                case 700: return '700-Roboto';\n                case 900: return '900-Roboto';\n                default: return '100-Roboto';\n            }\n        }\n    }\n\n    /**\n     * @summary     Adds a black border around the edges of the canvas element.\n     */\n    _AddStageBorder()\n    {\n        var bkg = new Konva.Rect({\n            x: 0,\n            y: 0,\n            width: this._stage.width(),\n            height: this._stage.height(),\n            fill: 'white',\n            stroke: 'black',\n        });\n        this._main.add(bkg);\n        bkg.moveToBottom();\n    }\n\n    /**\n     * @summary     Returns the width of a text element given the text's font.\n     * @description Using canvas' measureText function, _GetTextWidth returns the\n     *              width in pixels of a given piece of text.\n     * \n     * @param {string} text       The text we want to determine the width of.\n     * @param {double} fontSize   The font size of the text we want to find the width of.\n     * @param {string} fontFamily The font family of the text we want to analyze.\n     */\n    _GetTextWidth(text, fontSize, fontFamily)\n    {\n        var canvas = document.createElement('canvas');\n        var ctx = canvas.getContext('2d');\n\n        ctx.font = fontSize + 'px ' + fontFamily;\n        var helper = ctx.measureText(text).width;\n        canvas.remove();\n\n        return helper;\n    }\n    /**\n     * @param {double} width  The width of the element we are centering.\n     * @param {double} center The x-coordinate we want to center about.\n     */\n    _CenterXAbout(width, center)\n    {\n        return center - (width / 2);\n    }\n\n    /**\n     * @summary     Calls additional functions to complete the infographic.\n     * @description Renders all of the text elements and adds the capability to \n     *              edit graphs and text elements.\n     */\n    _FinalizeInfog()\n    {\n        this._RenderText();\n        this._AddGraphSelection();\n        this._AddTextSelection();\n        this._AddGraphicSelection();\n        // this._AddMultipleElementSelector();\n    }\n\n    /**\n     * @summary     Renders all of the text elements.\n     * @description Iterates through all of the elements in textHandler and converts\n     *              them from DOM elements to Konva.Image elements.\n     */\n    _RenderText()\n    {\n        var helperElem = document.createElement('div');\n        helperElem.style.position = 'absolute';\n        document.getElementById('renderHelper').appendChild(helperElem);\n\n        for (var i = 0; i < this._textHandler.GetSize(); i++) {\n            helperElem.appendChild(this._textHandler.GetTextElem(i));\n            this._HTMLToCanvas('.EditableText', i);\n            this._textHandler.GetTextElem(i).remove();\n        }\n        helperElem.remove();\n    }\n\n    /**\n     * @summary     Converts DOM elements on the page to Konva.Image elements\n     * @description Uses the html2canvas module to convert DOM elements located \n     *              within the body into Konva.Image elements.\n     * \n     * @param {int} index The index of the text element we want to convert.\n     */\n    _HTMLToCanvas(query, index)\n    {\n        var element = document.querySelector(query);\n        // var comp = window.getComputedStyle(element, null);\n        html2canvas(element, {\n            logging: false,\n            backgroundColor: null,\n            scrollY: -(window.scrollY),\n            // width: comp.width.replace('px', ''),\n        }).then((image) => {\n            // console.log('image width: ' + image.width)\n            this._textHandler.GetImage(index).image(image);\n            this._main.batchDraw();\n        }).catch(() => {\n            var helperElem = document.createElement('div');\n            helperElem.style.position = 'absolute';\n            document.getElementById('renderHelper').appendChild(helperElem);\n\n            helperElem.appendChild(this._textHandler.GetTextElem(index));\n            this._HTMLToCanvas('.EditableText', index);\n            this._textHandler.GetTextElem(index).remove();\n            helperElem.remove();\n        });\n        /*console.log('width: ' + comp.width);\n        console.log('height: ' + comp.height);\n        console.log('x: ' + comp.x);\n        console.log('y: ' + comp.y)*/\n    }\n\n    /**\n     * @summary     Adds the capability to select and edit text.\n     * @description Iterates through all of the elements in the text handler and\n     *              adds an event listener that triggers when the text element\n     *              is double clicked.\n     */\n    _AddTextSelection()\n    {\n        var selection = this._stage.find((node) => {\n            return node.hasName('Selectable') && node.hasName('EditableText');\n        });\n\n        selection.forEach((textElem) => {\n            textElem.on('dblclick', () => {\n                textElem.setAttr('draggable', true);\n\n                this._tr.nodes([textElem]);\n                this._tr.moveToTop();\n                this._main.batchDraw();\n\n                this._selectedTextIndex = textElem.getAttr('id');\n                this._selectedTextHelper = this._selectedTextIndex;\n  \n                this._textCallback(this._textHandler.GetHandlerElem(this._selectedTextIndex))\n                this._editorHandler('text-editor');\n\n                setTimeout(() => {\n                    this._stage.on('click', HandleOutsideClick);\n                });\n\n                var HandleOutsideClick = (e) => {\n                    if (e.target !== textElem) {\n                        this._selectedTextIndex = -1;\n                        this._editorHandler('none');\n                        this._tr.nodes([]);\n                        textElem.setAttr('draggable', false);\n                        this._main.batchDraw();\n                        this._stage.off('click', HandleOutsideClick);\n                    }\n                };\n            });\n\n            textElem.on('dragend', () => {\n                this._SwitchContainerOnDrag(textElem);\n            });\n        });\n    }\n\n    /**\n     * @summary     Updates current handler element.\n     * @description Updates the text handler element located at _selectedTextIndex\n     *              with data from the parameterized textElem variable.\n     * \n     * @param {JSON} textElem A JSON object containing the updated textElem information.\n     */\n    UpdateTextHandler(textElem)\n    {\n        if (textElem.image === undefined || textElem.textElem === undefined || \n            textElem.group === undefined || textElem.spanCSS === undefined || \n            textElem === 0) {\n            return;\n        } \n        this._textHandler.UpdateTextElem({\n            index: this._selectedTextHelper,\n            textElem: textElem.textElem,\n            group: textElem.group,\n            image: textElem.image,\n            spanCSS: textElem.spanCSS,\n        });\n        this._selectedTextHelper = -1;\n    }\n\n    Remove()\n    {\n        // TODO remove entries from handler\n        if (this._selectedChartIndex !== -1) {\n            this._tr.nodes([]);\n            this._main.batchDraw();\n            this._chartHandler.RemoveHandlerElem(this._selectedChartIndex);\n            this._selectedChartIndex = -1;\n        } else if (this._selectedTextIndex !== -1) {\n            this._tr.nodes([]);\n            this._main.batchDraw();\n            this._textHandler.RemoveHandlerElem(this._selectedTextIndex);\n            this._selectedChartIndex = -1;\n        } else if (this._selectedGraphicIndex !== -1) {\n            this._tr.nodes([]);\n            this._main.batchDraw();\n            this._graphicsHandler.RemoveHandlerElem(this._selectedGraphicIndex);\n            this._selectedGraphicIndex = -1;\n        }\n    }\n\n    UpdateChartDecorators(settings)\n    {\n        if (settings === 0 || this._selectedChartIndex === -1) return;\n        this._chartHandler.UpdateChartDecorators(this._selectedChartIndex, settings);\n    }\n\n    /**\n     * @summary     Updates the selected chart.\n     * @description Updates the chart (and its associated data) at index \n     *              _selectedChartIndex.\n     * @param {misc} chartData The structure of this variable depends on the \n     *                         type of chart we are dealing with.\n     */\n    UpdateChartData(chartData)\n    {\n        if (chartData === 0 || this._selectedChartIndex === -1) return;\n        var elem = this._chartHandler.GetHandlerElem(this._selectedChartIndex),\n            name = elem.group.getAttr('name');\n        if (name === 'Selectable Chart Waffle') {\n            // We assume that the data will be formatted as follows\n            // data = {\n            //    numerator: {num}, denominator: {num}\n            // }\n            if (chartData.numerator === 0 || chartData.denominator === 0) return;\n            var numerator = chartData.numerator, denominator = chartData.denominator;\n            elem.chart.UpdateData(parseInt(numerator), parseInt(denominator));\n        } else {\n            // We assume that the data will be formated as follows\n            // data = [\n            //    { category: {string}, value: {float}, color: {string}}, ...   \n            // ]\n            elem.chart.UpdateData(chartData);\n        } \n\n        this._UpdateDecorators(elem);\n    }\n\n    UpdateChartSettings(settings)\n    {\n        if (settings === 0 || this._selectedChartIndex === -1) return;\n        let elem = this._chartHandler.GetHandlerElem(this._selectedChartIndex);\n        elem.chart.UpdateChartSettings(settings);\n        this._UpdateDecorators(elem);\n    }\n\n    UpdateGraphicSettings(settings)\n    {\n        if (settings === 0 || this._selectedGraphicIndex === -1) return;\n        this._graphicsHandler.UpdateGraphicSettings({\n            id: this._selectedGraphicIndex, \n            settings:settings\n        });\n        this._tr.forceUpdate();\n        this._main.batchDraw();\n    }\n\n    /**\n     * @summary     Updates decorators.\n     * @description Iterates though all the decorators in handlerElem and updates\n     *              them.\n     * \n     * @param {JSON} handlerElem \n     */\n    _UpdateDecorators(handlerElem)\n    {\n        var prev = handlerElem.chart;\n        for (var i = 0; i <= handlerElem.decoratorSize; i++) {\n            handlerElem.decorators[i].UpdateDecorator(prev);\n            prev = handlerElem.decorators[i];\n        }\n        prev.CreateChart();\n        this._tr.forceUpdate();\n        this._main.batchDraw();\n    }\n\n    /**\n     * @summary     Adds the capability to select and edit graphs.\n     * @description Iterates through all of the elements in the graph handler and\n     *              adds an event listener when they are double clicked on.\n     */\n    _AddGraphSelection()\n    {\n        var selection = this._stage.find((node) => {\n            return node.hasName('Selectable') && node.hasName('Chart');\n        });\n        selection.forEach((chart) => {\n            /**\n             * Adds ability to select and edit graphs.\n             */\n            chart.on('dblclick', () => {\n                this._selectedChartIndex = parseInt(chart.getAttr('id'));\n                this._tr.nodes([chart]);\n                this._tr.moveToTop();\n                this._main.batchDraw();\n                chart.setAttr('draggable', true);\n\n                let selectedChart = this._chartHandler.GetHandlerElem(this._selectedChartIndex).chart,\n                    dSettings = this._chartHandler.GetDecoratorSettingsArray(this._selectedChartIndex);\n                this._chartCallback(selectedChart.GetData(), selectedChart.GetChartSettings(), dSettings);\n\n                if (chart.getAttr('name') === 'Selectable Chart Waffle') {\n                    this._editorHandler('waffle-editor');\n                } else if (chart.getAttr('name') === 'Selectable Chart Pie') {\n                    this._editorHandler('pie-editor');\n                } else if (chart.getAttr('name') === 'Selectable Chart Bar') {\n                    this._editorHandler('bar-editor')\n                } else if (chart.getAttr('name') === 'Selectable Chart Stacked') {\n                    this._editorHandler('stacked-bar-editor');\n                } else if (chart.getAttr('name') === 'Selectable Chart Line') {\n                    this._editorHandler('line-editor');\n                } else if (chart.getAttr('name') === 'Selectable Chart Icon') {\n                    this._editorHandler('icon-bar-editor');\n                } else if (chart.getAttr('name') === 'Selectable Chart Donut') {\n                    this._editorHandler('donut-editor');\n                }\n\n                setTimeout(() => {\n                    this._stage.on('click', HandleOutsideClick);\n                });\n\n                var HandleOutsideClick = (e) => {\n                    if (e.target !== chart) {\n                        this._selectedChartIndex = -1;\n                        this._editorHandler('none');\n                        this._tr.nodes([]);\n                        chart.setAttr('draggable', false);\n                        this._main.batchDraw();\n                        this._stage.off('click', HandleOutsideClick);\n                    }\n                };\n            });\n\n            chart.on('dragend', () => {\n                this._SwitchContainerOnDrag(chart);\n            });\n        });\n    }\n\n    _AddGraphicSelection()\n    {\n        var selection = this._stage.find((node) => {\n            return node.hasName('Graphic');\n        });\n\n        selection.forEach((group) => {\n            group.on('dblclick', () => {\n                this._selectedGraphicIndex = group.getAttr('id');\n                let type = this._graphicsHandler.GetType(this._selectedGraphicIndex);\n                this._tr.nodes([group]);\n                this._tr.moveToTop();\n                this._main.batchDraw();\n                group.setAttr('draggable', true);\n\n                this._editorHandler(type + '-editor');\n\n                this._graphicCallback(\n                    this._graphicsHandler.GetSettings(this._selectedGraphicIndex)\n                );\n\n                setTimeout(() => {\n                    this._stage.on('click', HandleOutsideClick);\n                });\n\n                var HandleOutsideClick = (e) => {\n                    if (e.target !== group) {\n                        this._selectedGraphicIndex = -1;\n                        this._tr.nodes([]);\n                        group.setAttr('draggable', false);\n                        this._main.batchDraw();\n                        this._editorHandler('none');\n                        this._stage.off('click', HandleOutsideClick);\n                    }\n                };\n            });\n\n            group.on('dragend', () => {\n                this._SwitchContainerOnDrag(group);\n            });\n        });\n    }\n\n    _SwitchContainerOnDrag(elem)\n    {\n        let selection = this._stage.find((node) => {\n            return node.hasName('Switchable') && node.hasName('Container');\n        }),\n            parent = this._FindTopContainer(elem);\n        \n        selection = selection.filter(d => parent !== d)\n    \n        selection.forEach(group => {\n            if (Konva.Util.haveIntersection(group.getClientRect(), elem.getClientRect())) {\n                let absPos = elem.getAbsolutePosition();\n                elem.moveTo(group);\n                elem.absolutePosition({\n                    x: absPos.x,\n                    y: absPos.y\n                });\n            }\n        });\n    }\n\n    _FindTopContainer(elem)\n    {\n        let parent = elem.getParent();\n        while (parent.getDepth > 2 || !parent.hasName('Switchable')) {\n            parent = parent.getParent();\n        }\n        return parent;\n    }\n\n    _AddMultipleElementSelector()\n    {\n        this._main.add(this._selectionRectangle);\n        this._MultipleSelectorStart();\n        this._MultipleSelectorMove();\n        this._MultipleSelectorEnd();\n        this._MultipleSelectorDeselect();\n    }\n\n    _MultipleSelectorStart()\n    {\n        this._stage.on('mousedown touchstart', e => {\n            //if (e.target !== this._stage) return;\n            this._isSelecting = true;\n\n            this._mouseX1 = this._stage.getPointerPosition().x;\n            this._mouseX2 = this._mouseX1;\n            this._mouseY1 = this._stage.getPointerPosition().y;\n            this._mouseY2 = this._mouseY1;\n\n            this._selectionRectangle.visible(true);\n            this._selectionRectangle.width(0);\n            this._selectionRectangle.height(0);\n            this._main.batchDraw();\n        });\n    }\n\n    _MultipleSelectorMove()\n    {\n        this._stage.on('mousemove touchmove', () => {\n            if (!this._selectionRectangle.visible()) return;\n\n            this._mouseX2 = this._stage.getPointerPosition().x;\n            this._mouseY2 = this._stage.getPointerPosition().y;\n\n            this._selectionRectangle.setAttrs({\n                x: Math.min(this._mouseX1, this._mouseX2),\n                y: Math.min(this._mouseY1, this._mouseY2),\n                width: Math.abs(this._mouseX2 - this._mouseX1),\n                height: Math.abs(this._mouseY2 - this._mouseY1),\n            });\n\n            this._main.batchDraw();\n        });\n    }\n\n    _MultipleSelectorEnd()\n    {\n        this._stage.on('mouseup touchend', () => {\n            if (!this._selectionRectangle.visible()) return;\n            // selection code \n            var elems = this._stage.find('.Selectable').toArray();\n            var box = this._selectionRectangle.getClientRect();\n            /*var selected = elems.filter((element) => {\n                if (Konva.Util.haveIntersection(box, element.getClientRect())) {\n                    alert('h')\n                    return element;\n                }\n                var x = element.getClientRect().x,\n                    y = element.getClientRect().y;\n                if (x >= box.x &&\n                    x <= box.x + box.width &&\n                    y >= box.y &&\n                    y <= box.y + box.height)\n                {\n                    element.setAttr('draggable', true);\n                    this._oldNodes.push(element);\n                    return element;\n                }\n            });*/\n\n            var selected = elems.filter((elem) =>\n                Konva.Util.haveIntersection(box, elem.getClientRect())\n            );\n            console.log(selected)\n\n            this._tr.nodes(selected);\n            this._tr.moveToTop();\n            this._main.batchDraw();\n\n            setTimeout(() => {\n                this._selectionRectangle.visible(false);\n                this._main.batchDraw();\n                this._hasSelected = true;\n                this._isSelecting = false;\n            });\n        });\n    }\n\n    _MultipleSelectorDeselect()\n    {\n        this._stage.on('click tap', e => {\n            if (this._selectionRectangle.visible()) return;\n            if (this._hasSelected) {\n                this._oldNodes.forEach(node => {\n                    node.setAttr('draggable', false);\n                });\n                \n                this._tr.nodes([]);\n                this._main.batchDraw();\n                this._hasSelected = false;\n                return;\n            }\n        });\n    }\n}\n\nexport { AInfographic };"]},"metadata":{},"sourceType":"module"}